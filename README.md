# koa-ts-cli

åŸºäº `koa-ts-core` çš„ç°ä»£åŒ– TypeScript + Koa é¡¹ç›®è„šæ‰‹æ¶ CLI å·¥å…·ã€‚

æä¾›äº†ä¸€å¥—å®Œæ•´çš„å·¥ç¨‹åŒ–è§£å†³æ–¹æ¡ˆï¼Œä»é¡¹ç›®åˆ›å»ºã€å¼€å‘è°ƒè¯•ã€ä»£ç ç”Ÿæˆåˆ°æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆï¼Œæå¤§åœ°æå‡ Koa é¡¹ç›®çš„å¼€å‘æ•ˆç‡ã€‚

## æ ¸å¿ƒç‰¹æ€§

- **ğŸ›  å¼€ç®±å³ç”¨**: ä¸€é”®åˆ›å»ºåŸºäº TypeScript çš„ Koa é¡¹ç›®ï¼Œå†…ç½®æœ€ä½³å®è·µç›®å½•ç»“æ„ã€‚
- **âš¡ï¸ æé€Ÿå¼€å‘**: å†…ç½® `ts-node` å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒæ–‡ä»¶å˜æ›´çƒ­é‡è½½ã€‚
- **ğŸ“ æ–‡æ¡£ç”Ÿæˆ**: è‡ªåŠ¨æ‰«æ `@Router` è£…é¥°å™¨ï¼Œä¸€é”®ç”Ÿæˆç¬¦åˆ `koa2-swagger-ui` æ ‡å‡†çš„æ¥å£æ–‡æ¡£ã€‚
- **ğŸ§© æ·±åº¦é›†æˆ**: ä¸ [`koa-ts-core`](https://www.npmjs.com/package/koa-ts-core) æ— ç¼é…åˆï¼Œæä¾›å¼ºå¤§çš„è·¯ç”±ã€é‰´æƒã€æ ¡éªŒèƒ½åŠ›ã€‚
- **ğŸ— ä»£ç ç”Ÿæˆ**: ä¸€é”®ç”Ÿæˆ Controller (æ§åˆ¶å™¨) å’Œ Validator (æ ¡éªŒå™¨) æ¨¡æ¿ä»£ç ã€‚

---

## ä¾èµ–è¦æ±‚

- Node.js >= 16.0.0
- npm / yarn / pnpm

## å®‰è£…

```bash
npm install -g koa-typescript-cli
# æˆ–è€…
yarn global add koa-typescript-cli
# æˆ–è€…
pnpm add -g koa-typescript-cli
```

å®‰è£…å®Œæˆåï¼Œä½ å°†åœ¨å…¨å±€è·å¾— `koa-ts-cli` å‘½ä»¤ã€‚

---

## å¿«é€Ÿä¸Šæ‰‹

### 1. åˆ›å»ºé¡¹ç›®

ä½¿ç”¨ `create` å‘½ä»¤åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„å·¥ç¨‹ï¼š

```bash
koa-ts-cli create my-app
```

**å¯é€‰å‚æ•°ï¼š**

- `-n, --npm_type <type>`: æŒ‡å®šåŒ…ç®¡ç†å™¨ (`npm` | `yarn` | `pnpm`)ï¼Œé»˜è®¤ä¸º `npm`ã€‚
- `-r, --registry <url>`: æŒ‡å®š npm é•œåƒæº (ä¾‹å¦‚ `https://registry.npmmirror.com`)ã€‚

**ç›®å½•ç»“æ„é¢„è§ˆï¼š**

```text
my-app
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ controller  # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ validate    # å‚æ•°æ ¡éªŒå±‚
â”‚   â””â”€â”€ main.ts     # åº”ç”¨å…¥å£
â”œâ”€â”€ env             # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### 2. å¯åŠ¨å¼€å‘ç¯å¢ƒ

è¿›å…¥é¡¹ç›®ç›®å½•å¹¶å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š

```bash
cd my-app
koa-ts-cli dev
```

è¯¥å‘½ä»¤ä¼šè‡ªåŠ¨ï¼š
- å¯åŠ¨ TypeScript ç¼–è¯‘ä¸è¿è¡Œç¯å¢ƒã€‚
- ç›‘å¬ `src` ç›®å½•æºç å˜æ›´ï¼Œè‡ªåŠ¨é‡å¯æœåŠ¡ã€‚
- åŠ è½½ `env/.development.env` ç¯å¢ƒå˜é‡ã€‚

### 3. ç”Ÿæˆä»£ç æ¨¡æ¿

ä½¿ç”¨ `add` å‘½ä»¤å¿«é€Ÿç”Ÿæˆä¸šåŠ¡ä»£ç ï¼š

```bash
# ç”Ÿæˆ User æ¨¡å—çš„æ§åˆ¶å™¨å’Œæ ¡éªŒå™¨
koa-ts-cli add user -c controller/api/v1/UserInfo -v validate/api/v1/UserInfo
```

**å‚æ•°è¯´æ˜ï¼š**
- `-c, --controller <path>`: æ§åˆ¶å™¨æ–‡ä»¶è·¯å¾„ (ç›¸å¯¹äº `src`)ã€‚
- `-v, --validate <path>`: æ ¡éªŒå™¨æ–‡ä»¶è·¯å¾„ (ç›¸å¯¹äº `src`)ã€‚

ç”Ÿæˆçš„ä»£ç ä¼šè‡ªåŠ¨åŒ…å« `koa-ts-core` çš„ `@Router` å’Œ `@Validate` è£…é¥°å™¨æ¨¡æ¿ã€‚

### 4. ç”Ÿæˆæ¥å£æ–‡æ¡£

åç«¯æ¥å£å˜æ›´åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤è‡ªåŠ¨ç”Ÿæˆ Swagger æ–‡æ¡£é…ç½®ï¼š

```bash
koa-ts-cli doc
```

**å·¥ä½œåŸç†ï¼š**
1. æ‰«æ `src/controller` ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚
2. è§£æ `koa-ts-core` çš„ `Symbol(route_metadata)` å…ƒæ•°æ®ã€‚
3. æå– API è·¯å¾„ã€æ–¹æ³•ã€å‚æ•°ç­‰ä¿¡æ¯ã€‚
4. åœ¨é¡¹ç›®æ ¹ç›®å½•ç”Ÿæˆ `doc` æ–‡ä»¶å¤¹ï¼ŒåŒ…å«ç¬¦åˆ Swagger è§„èŒƒçš„æ–‡æ¡£é…ç½®ä»£ç ã€‚

---

## å‘½ä»¤è¯¦è§£

### `create`
åˆ›å»ºæ–°é¡¹ç›®ã€‚

```bash
koa-ts-cli create <project_name> [options]
```

### `add`
æ·»åŠ ä»£ç æ¨¡æ¿ã€‚

```bash
koa-ts-cli add <template_name> [options]
```

### `dev`
å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚

```bash
koa-ts-cli dev
```

### `build`
æ„å»ºç”Ÿäº§ç¯å¢ƒä»£ç ã€‚

```bash
```bash
koa-ts-cli build [options]
```

**å¯é€‰å‚æ•°ï¼š**
- `-D, --doc`: è‡ªåŠ¨ç¼–è¯‘å¹¶å°† `doc/` ç›®å½•æ‰“åŒ…åˆ°æ„å»ºäº§ç‰©ä¸­ (éœ€è¦å…ˆæ‰‹åŠ¨è¿è¡Œ `doc` ç”Ÿæˆæ–‡æ¡£)ã€‚
- `-c, --copy_env`: è‡ªåŠ¨å¤åˆ¶ `env/` ç›®å½•åˆ°æ„å»ºäº§ç‰©ä¸­ã€‚

ä¼šè‡ªåŠ¨æ‰§è¡Œ `tsc` ç¼–è¯‘ï¼Œå¹¶å¤„ç†é™æ€èµ„æºï¼ˆå¦‚æ¨¡æ¿æ–‡ä»¶ï¼‰çš„å¤åˆ¶ã€‚

### `doc`
ç”Ÿæˆæ¥å£æ–‡æ¡£ã€‚é€‚ç”¨äºä½¿ç”¨ `koa-ts-core` å¼€å‘çš„é¡¹ç›®ã€‚

```bash
koa-ts-cli doc
```

---

## å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆè¿è¡Œ `koa-ts-cli doc` æŠ¥é”™ "Cannot read properties of undefined"?**

A: é€šå¸¸æ˜¯å› ä¸ºé¡¹ç›®ä¸­çš„ Controller ä¾èµ–è£…é¥°å™¨ï¼Œä½†æ‰§è¡Œç¯å¢ƒæœªå¯ç”¨ `experimentalDecorators`ã€‚æœ€æ–°ç‰ˆçš„ `koa-ts-cli` å·²å†…ç½®ä¿®å¤äº†æ­¤é—®é¢˜ï¼Œè¯·ç¡®ä¿æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚

**Q: ç”Ÿæˆçš„æ–‡æ¡£åœ¨å“ªé‡ŒæŸ¥çœ‹ï¼Ÿ**

A: `doc` å‘½ä»¤ä»…ç”Ÿæˆæ–‡æ¡£**é…ç½®ä»£ç ** (åœ¨ `doc/` ç›®å½•ä¸‹)ã€‚ä½ éœ€è¦å¯åŠ¨é¡¹ç›®æœåŠ¡ï¼Œé€šè¿‡ `koa-ts-core` å†…ç½®çš„ Swagger UI ä¸­é—´ä»¶æ¥è®¿é—®æ–‡æ¡£é¡µé¢ (é»˜è®¤è·¯å¾„ `/swagger-ui`)ã€‚

---

## é“¾æ¥

- [koa-ts-core](https://www.npmjs.com/package/koa-ts-core): æ ¸å¿ƒæ¡†æ¶åº“
- [Issues](https://github.com/SuPeiSen/koa-ts-cli/issues): é—®é¢˜åé¦ˆ
